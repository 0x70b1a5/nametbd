<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>Masque</title>
  <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
  <script src="../../EZGUI/js/EZGUI.js"></script>
  <script src="./app-gui.js"></script>

  <style type="text/css">
    body {
      margin: 0;
    }
  </style>
</head>
<body>


<script type="text/javascript">

  // GUI
  var menuScreen;
  var gameScreen;

  function setupGUI() {
    EZGUI.components.playBtn.on('click', function() {
      gameScreen.visible = true;
      menuScreen.visible = false;
    });

    EZGUI.components.quitBtn.on('click', function() {
      gameScreen.visible = false;
      menuScreen.visible = true;
    })
  }

  EZGUI.Theme.load(['../EZGUI/assets/metalworks-theme/metalworks-theme.json'], function() {
    menuScreen = EZGUI.create(menuScreenJSON, 'metalworks');

    gameScreen = EZGUI.create(gameScreenJSON, 'metalworks');
    gameScreen.visible = false;

    setupGUI();
  })

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

  function preload() {
    game.load.spritesheet('player', 'assets/dude.png', 32, 48);
    game.load.tilemap('map', 'assets/map.csv');
    game.load.image('tileset','assets/tileset.png');
  }

  var map;
  var layer0;
  var cursors;

  function create() {
    game.physics.startSystem(Phaser.Physics.ARCADE);

    map = game.add.tilemap('map', 32, 32);
    map.addTilesetImage('tileset');

    layer0 = map.createLayer(0);
    layer0.resizeWorld();

    player = game.add.sprite(32, game.world.height-150, 'player');
    game.physics.arcade.enable(player);
    player.body.collideWorldBounds = true;
    player.animations.add('walk', [1,2], 10, true);

    cursors = game.input.keyboard.createCursorKeys();
  }

  function update() {
    //movement: LR
    if (cursors.left.isDown )
    {
      player.body.velocity.x = -150;
      player.animations.play('walk');
    }
    else if (cursors.right.isDown )
    {
      player.body.velocity.x = 150;
      player.animations.play('walk');
    }
    else {
      player.body.velocity.x = 0;
    }
    //movement: UD
    if (cursors.up.isDown )
    {
      player.body.velocity.y = -150;
      player.animations.play('walk');
    }
    else if (cursors.down.isDown )
    {
      player.body.velocity.y = 150;
      player.animations.play('walk');
    }
    else {
      player.body.velocity.y = 0;
    }

    if (player.body.velocity.x == 0 && player.body.velocity.y == 0)
    {
      player.animations.stop();
    }
  }


</script>
</body>
</html>